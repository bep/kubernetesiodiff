<html>
  <body>
    <h1>
      Configure a Security Context for a Pod or Container
    </h1>
    <p>
      <a href="https://github.com/kubernetes/website/edit/master/content/en/docs/tasks/configure-pod-container/security-context.md" id="editPageButton" target="_blank">
        Edit This Page
      </a>
    </p>
    <h1>
      Configure a Security Context for a Pod or Container
    </h1>
    <p>
      A security context defines privilege and access control settings for
      a Pod or Container. Security context settings include:
    </p>
    <ul>
      <li>
        <p>
          Discretionary Access Control: Permission to access an object, like a file, is based on
          <a href="https://wiki.archlinux.org/index.php/users_and_groups">
            user ID (UID) and group ID (GID)
          </a>
          .
        </p>
      </li>
      <li>
        <p>
          <a href="https://en.wikipedia.org/wiki/Security-Enhanced_Linux">
            Security Enhanced Linux (SELinux)
          </a>
          : Objects are assigned security labels.
        </p>
      </li>
      <li>
        <p>
          Running as privileged or unprivileged.
        </p>
      </li>
      <li>
        <p>
          <a href="https://linux-audit.com/linux-capabilities-hardening-linux-binaries-by-removing-setuid/">
            Linux Capabilities
          </a>
          : Give a process some privileges, but not all the privileges of the root user.
        </p>
      </li>
      <li>
        <p>
          <a href="/docs/tutorials/clusters/apparmor/">
            AppArmor
          </a>
          : Use program profiles to restrict the capabilities of individual programs.
        </p>
      </li>
      <li>
        <p>
          <a href="https://en.wikipedia.org/wiki/Seccomp">
            Seccomp
          </a>
          : Filter a process&rsquo;s system calls.
        </p>
      </li>
      <li>
        <p>
          AllowPrivilegeEscalation: Controls whether a process can gain more privileges than its parent process. This bool directly controls whether the
          <a href="https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt">
            <code>
              no_new_privs
            </code>
          </a>
          flag gets set on the container process. AllowPrivilegeEscalation is true always when the container is: 1) run as Privileged OR 2) has
          <code>
            CAP_SYS_ADMIN
          </code>
          .
        </p>
      </li>
    </ul>
    <p>
      For more information about security mechanisms in Linux, see
      <a href="https://www.linux.com/learn/overview-linux-kernel-security-features">
        Overview of Linux Kernel Security Features
      </a>
    </p>
    <ul id="markdown-toc">
      <li>
        <a href="#before-you-begin">
          Before you begin
        </a>
      </li>
      <li>
        <a href="#set-the-security-context-for-a-pod">
          Set the security context for a Pod
        </a>
      </li>
      <li>
        <a href="#configure-volume-permission-and-ownership-change-policy-for-pods">
          Configure volume permission and ownership change policy for Pods
        </a>
      </li>
      <li>
        <a href="#set-the-security-context-for-a-container">
          Set the security context for a Container
        </a>
      </li>
      <li>
        <a href="#set-capabilities-for-a-container">
          Set capabilities for a Container
        </a>
      </li>
      <li>
        <a href="#assign-selinux-labels-to-a-container">
          Assign SELinux labels to a Container
        </a>
      </li>
      <li>
        <a href="#discussion">
          Discussion
        </a>
      </li>
      <li>
        <a href="#clean-up">
          Clean up
        </a>
      </li>
      <li>
        <a href="#what-s-next">
          What's next
        </a>
      </li>
    </ul>
    <h2 id="before-you-begin">
      Before you begin
    </h2>
    <p>
      You need to have a Kubernetes cluster, and the kubectl command-line tool must
      be configured to communicate with your cluster. If you do not already have a
      cluster, you can create one by using
      <a href="/docs/setup/learning-environment/minikube/">
        Minikube
      </a>
      ,
      or you can use one of these Kubernetes playgrounds:
    </p>
    <ul>
      <li>
        <a href="https://www.katacoda.com/courses/kubernetes/playground">
          Katacoda
        </a>
      </li>
      <li>
        <a href="http://labs.play-with-k8s.com/">
          Play with Kubernetes
        </a>
      </li>
    </ul>
    <p>
      To check the version, enter
      <code>
        kubectl version
      </code>
      .
    </p>
    <h2 id="set-the-security-context-for-a-pod">
      Set the security context for a Pod
    </h2>
    <p>
      To specify security settings for a Pod, include the
      <code>
        securityContext
      </code>
      field
      in the Pod specification. The
      <code>
        securityContext
      </code>
      field is a
      <a href="/docs/reference/generated/kubernetes-api/v1.18/#podsecuritycontext-v1-core">
        PodSecurityContext
      </a>
      object.
      The security settings that you specify for a Pod apply to all Containers in the Pod.
      Here is a configuration file for a Pod that has a
      <code>
        securityContext
      </code>
      and an
      <code>
        emptyDir
      </code>
      volume:
    </p>
    <table class="includecode" id="pods-security-security-context-yaml">
      <thead>
        <tr>
          <th>
            <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/pods/security/security-context.yaml" download="pods/security/security-context.yaml">
              <code>
                pods/security/security-context.yaml
              </code>
            </a>
            <img src="/dir1/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-security-security-context-yaml')" title="Copy pods/security/security-context.yaml to clipboard">
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="highlight">
              <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#a2f;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>security-context-demo<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">runAsUser</span>:<span style="color:#bbb"> </span><span style="color:#666">1000</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">runAsGroup</span>:<span style="color:#bbb"> </span><span style="color:#666">3000</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">fsGroup</span>:<span style="color:#bbb"> </span><span style="color:#666">2000</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">volumes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>sec-ctx-vol<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">emptyDir</span>:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>sec-ctx-demo<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">image</span>:<span style="color:#bbb"> </span>busybox<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">command</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#b44">&#34;sh&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;-c&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;sleep 1h&#34;</span><span style="color:#bbb"> </span>]<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">volumeMounts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>sec-ctx-vol<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/data/demo<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">allowPrivilegeEscalation</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span></code></pre>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      In the configuration file, the
      <code>
        runAsUser
      </code>
      field specifies that for any Containers in
      the Pod, all processes run with user ID 1000. The
      <code>
        runAsGroup
      </code>
      field specifies the primary group ID of 3000 for
      all processes within any containers of the Pod. If this field is omitted, the primary group ID of the containers
      will be root(0). Any files created will also be owned by user 1000 and group 3000 when
      <code>
        runAsGroup
      </code>
      is specified.
      Since
      <code>
        fsGroup
      </code>
      field is specified, all processes of the container are also part of the supplementary group ID 2000.
      The owner for volume
      <code>
        /data/demo
      </code>
      and any files created in that volume will be Group ID 2000.
    </p>
    <p>
      Create the Pod:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/security/security-context.yaml</code></pre>
    </div>
    <p>
      Verify that the Pod&rsquo;s Container is running:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pod security-context-demo</code></pre>
    </div>
    <p>
      Get a shell to the running Container:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -it security-context-demo -- sh</code></pre>
    </div>
    <p>
      In your shell, list the running processes:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ps</code></pre>
    </div>
    <p>
      The output shows that the processes are running as user 1000, which is the value of
      <code>
        runAsUser
      </code>
      :
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PID   USER     TIME  COMMAND
    <span style="color:#666">1</span> <span style="color:#666">1000</span>      0:00 sleep 1h
    <span style="color:#666">6</span> <span style="color:#666">1000</span>      0:00 sh
...</code></pre>
    </div>
    <p>
      In your shell, navigate to
      <code>
        /data
      </code>
      , and list the one directory:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f">cd</span> /data
ls -l</code></pre>
    </div>
    <p>
      The output shows that the
      <code>
        /data/demo
      </code>
      directory has group ID 2000, which is
      the value of
      <code>
        fsGroup
      </code>
      .
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">drwxrwsrwx <span style="color:#666">2</span> root <span style="color:#666">2000</span> <span style="color:#666">4096</span> Jun  <span style="color:#666">6</span> 20:08 demo</code></pre>
    </div>
    <p>
      In your shell, navigate to
      <code>
        /data/demo
      </code>
      , and create a file:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f">cd</span> demo
<span style="color:#a2f">echo</span> hello &gt; testfile</code></pre>
    </div>
    <p>
      List the file in the
      <code>
        /data/demo
      </code>
      directory:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ls -l</code></pre>
    </div>
    <p>
      The output shows that
      <code>
        testfile
      </code>
      has group ID 2000, which is the value of
      <code>
        fsGroup
      </code>
      .
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">-rw-r--r-- <span style="color:#666">1</span> <span style="color:#666">1000</span> <span style="color:#666">2000</span> <span style="color:#666">6</span> Jun  <span style="color:#666">6</span> 20:08 testfile</code></pre>
    </div>
    <p>
      Run the following command:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ id
<span style="color:#b8860b">uid</span><span style="color:#666">=</span><span style="color:#666">1000</span> <span style="color:#b8860b">gid</span><span style="color:#666">=</span><span style="color:#666">3000</span> <span style="color:#b8860b">groups</span><span style="color:#666">=</span><span style="color:#666">2000</span></code></pre>
    </div>
    <p>
      You will see that gid is 3000 which is same as
      <code>
        runAsGroup
      </code>
      field. If the
      <code>
        runAsGroup
      </code>
      was omitted the gid would
      remain as 0(root) and the process will be able to interact with files that are owned by root(0) group and that have
      the required group permissions for root(0) group.
    </p>
    <p>
      Exit your shell:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">exit</code></pre>
    </div>
    <h2 id="configure-volume-permission-and-ownership-change-policy-for-pods">
      Configure volume permission and ownership change policy for Pods
    </h2>
    <div style="margin-top: 10px; margin-bottom: 10px;">
      <b>
        FEATURE STATE:
      </b>
      <code>
        Kubernetes v1.18
      </code>
      <a href="#" id="feature-state-dialog-link" class="ui-state-default ui-corner-all">
        <span class="ui-icon ui-icon-newwin"></span>
        alpha
      </a>
      <div id="feature-state-dialog" class="ui-dialog-content" title="alpha">
        <p>
          This feature is currently in a
          <em>
            alpha
          </em>
          state, meaning:
        </p>
        <ul>
          <li>
            The version names contain alpha (e.g. v1alpha1).
          </li>
          <li>
            Might be buggy. Enabling the feature may expose bugs. Disabled by default.
          </li>
          <li>
            Support for feature may be dropped at any time without notice.
          </li>
          <li>
            The API may change in incompatible ways in a later software release without notice.
          </li>
          <li>
            Recommended for use only in short-lived testing clusters, due to increased risk of bugs and lack of long-term support.
          </li>
        </ul>
      </div>
      <script>
        $(function(){

        $( "#feature-state-dialog" ).dialog({
        autoOpen: false,
        width: "600",
        buttons: [
        {
        text: "Ok",
        click: function() {
        $( this ).dialog( "close" );
        }
        }
        ]
        });


        $( "#feature-state-dialog-link" ).click(function( event ) {
        $( "#feature-state-dialog" ).dialog( "open" );
        event.preventDefault();
        });

        });
      </script>
    </div>
    <p>
      By default, Kubernetes recursively changes ownership and permissions for the contents of each
      volume to match the
      <code>
        fsGroup
      </code>
      specified in a Pod&rsquo;s
      <code>
        securityContext
      </code>
      when that volume is
      mounted.
      For large volumes, checking and changing ownership and permissions can take a lot of time,
      slowing Pod startup. You can use the
      <code>
        fsGroupChangePolicy
      </code>
      field inside a
      <code>
        securityContext
      </code>
      to control the way that Kubernetes checks and manages ownership and permissions
      for a volume.
    </p>
    <p>
      <strong>
        fsGroupChangePolicy
      </strong>
      -
      <code>
        fsGroupChangePolicy
      </code>
      defines behavior for changing ownership and permission of the volume
      before being exposed inside a Pod. This field only applies to volume types that support
      <code>
        fsGroup
      </code>
      controlled ownership and permissions. This field has two possible values:
    </p>
    <ul>
      <li>
        <em>
          OnRootMismatch
        </em>
        : Only change permissions and ownership if permission and ownership of root directory does not match with expected permissions of the volume. This could help shorten the time it takes to change ownership and permission of a volume.
      </li>
      <li>
        <em>
          Always
        </em>
        : Always change permission and ownership of the volume when volume is mounted.
      </li>
    </ul>
    <p>
      For example:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">runAsUser</span>:<span style="color:#bbb"> </span><span style="color:#666">1000</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">runAsGroup</span>:<span style="color:#bbb"> </span><span style="color:#666">3000</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">fsGroup</span>:<span style="color:#bbb"> </span><span style="color:#666">2000</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">fsGroupChangePolicy</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;OnRootMismatch&#34;</span></code></pre>
    </div>
    <p>
      This is an alpha feature. To use it, enable the
      <a href="/docs/reference/command-line-tools-reference/feature-gates/">
        feature gate
      </a>
      <code>
        ConfigurableFSGroupPolicy
      </code>
      for the kube-api-server, the kube-controller-manager, and for the kubelet.
    </p>
    <blockquote class="note">
      <div>
        <strong>
          Note:
        </strong>
        This field has no effect on ephemeral volume types such as
        <a href="https://kubernetes.io/docs/concepts/storage/volumes/#secret">
          <code>
            secret
          </code>
        </a>
        ,
        <a href="https://kubernetes.io/docs/concepts/storage/volumes/#configmap">
          <code>
            configMap
          </code>
        </a>
        ,
        and
        <a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir">
          <code>
            emptydir
          </code>
        </a>
        .
      </div>
    </blockquote>
    <h2 id="set-the-security-context-for-a-container">
      Set the security context for a Container
    </h2>
    <p>
      To specify security settings for a Container, include the
      <code>
        securityContext
      </code>
      field
      in the Container manifest. The
      <code>
        securityContext
      </code>
      field is a
      <a href="/docs/reference/generated/kubernetes-api/v1.18/#securitycontext-v1-core">
        SecurityContext
      </a>
      object.
      Security settings that you specify for a Container apply only to
      the individual Container, and they override settings made at the Pod level when
      there is overlap. Container settings do not affect the Pod&rsquo;s Volumes.
    </p>
    <p>
      Here is the configuration file for a Pod that has one Container. Both the Pod
      and the Container have a
      <code>
        securityContext
      </code>
      field:
    </p>
    <table class="includecode" id="pods-security-security-context-2-yaml">
      <thead>
        <tr>
          <th>
            <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/pods/security/security-context-2.yaml" download="pods/security/security-context-2.yaml">
              <code>
                pods/security/security-context-2.yaml
              </code>
            </a>
            <img src="/dir1/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-security-security-context-2-yaml')" title="Copy pods/security/security-context-2.yaml to clipboard">
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="highlight">
              <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#a2f;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>security-context-demo<span style="color:#666">-2</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">runAsUser</span>:<span style="color:#bbb"> </span><span style="color:#666">1000</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>sec-ctx-demo<span style="color:#666">-2</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">image</span>:<span style="color:#bbb"> </span>gcr.io/google-samples/node-hello:<span style="color:#666">1.0</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">runAsUser</span>:<span style="color:#bbb"> </span><span style="color:#666">2000</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">allowPrivilegeEscalation</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb">
</span></code></pre>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      Create the Pod:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/security/security-context-2.yaml</code></pre>
    </div>
    <p>
      Verify that the Pod&rsquo;s Container is running:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pod security-context-demo-2</code></pre>
    </div>
    <p>
      Get a shell into the running Container:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -it security-context-demo-2 -- sh</code></pre>
    </div>
    <p>
      In your shell, list the running processes:
    </p>
    <pre><code>ps aux</code></pre>
    <p>
      The output shows that the processes are running as user 2000. This is the value
      of
      <code>
        runAsUser
      </code>
      specified for the Container. It overrides the value 1000 that is
      specified for the Pod.
    </p>
    <pre><code>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
2000         1  0.0  0.0   4336   764 ?        Ss   20:36   0:00 /bin/sh -c node server.js
2000         8  0.1  0.5 772124 22604 ?        Sl   20:36   0:00 node server.js
...</code></pre>
    <p>
      Exit your shell:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">exit</code></pre>
    </div>
    <h2 id="set-capabilities-for-a-container">
      Set capabilities for a Container
    </h2>
    <p>
      With
      <a href="http://man7.org/linux/man-pages/man7/capabilities.7.html">
        Linux capabilities
      </a>
      ,
      you can grant certain privileges to a process without granting all the privileges
      of the root user. To add or remove Linux capabilities for a Container, include the
      <code>
        capabilities
      </code>
      field in the
      <code>
        securityContext
      </code>
      section of the Container manifest.
    </p>
    <p>
      First, see what happens when you don&rsquo;t include a
      <code>
        capabilities
      </code>
      field.
      Here is configuration file that does not add or remove any Container capabilities:
    </p>
    <table class="includecode" id="pods-security-security-context-3-yaml">
      <thead>
        <tr>
          <th>
            <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/pods/security/security-context-3.yaml" download="pods/security/security-context-3.yaml">
              <code>
                pods/security/security-context-3.yaml
              </code>
            </a>
            <img src="/dir1/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-security-security-context-3-yaml')" title="Copy pods/security/security-context-3.yaml to clipboard">
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="highlight">
              <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#a2f;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>security-context-demo<span style="color:#666">-3</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>sec-ctx<span style="color:#666">-3</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">image</span>:<span style="color:#bbb"> </span>gcr.io/google-samples/node-hello:<span style="color:#666">1.0</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      Create the Pod:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/security/security-context-3.yaml</code></pre>
    </div>
    <p>
      Verify that the Pod&rsquo;s Container is running:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl get pod security-context-demo-3</code></pre>
    </div>
    <p>
      Get a shell into the running Container:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -it security-context-demo-3 -- sh</code></pre>
    </div>
    <p>
      In your shell, list the running processes:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ps aux</code></pre>
    </div>
    <p>
      The output shows the process IDs (PIDs) for the Container:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">USER  PID %CPU %MEM    VSZ   RSS TTY   STAT START   TIME COMMAND
root    <span style="color:#666">1</span>  0.0  0.0   <span style="color:#666">4336</span>   <span style="color:#666">796</span> ?     Ss   18:17   0:00 /bin/sh -c node server.js
root    <span style="color:#666">5</span>  0.1  0.5 <span style="color:#666">772124</span> <span style="color:#666">22700</span> ?     Sl   18:17   0:00 node server.js</code></pre>
    </div>
    <p>
      In your shell, view the status for process 1:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f">cd</span> /proc/1
cat status</code></pre>
    </div>
    <p>
      The output shows the capabilities bitmap for the process:
    </p>
    <pre><code>...
CapPrm:	00000000a80425fb
CapEff:	00000000a80425fb
...</code></pre>
    <p>
      Make a note of the capabilities bitmap, and then exit your shell:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">exit</code></pre>
    </div>
    <p>
      Next, run a Container that is the same as the preceding container, except
      that it has additional capabilities set.
    </p>
    <p>
      Here is the configuration file for a Pod that runs one Container. The configuration
      adds the
      <code>
        CAP_NET_ADMIN
      </code>
      and
      <code>
        CAP_SYS_TIME
      </code>
      capabilities:
    </p>
    <table class="includecode" id="pods-security-security-context-4-yaml">
      <thead>
        <tr>
          <th>
            <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/pods/security/security-context-4.yaml" download="pods/security/security-context-4.yaml">
              <code>
                pods/security/security-context-4.yaml
              </code>
            </a>
            <img src="/dir1/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode('pods-security-security-context-4-yaml')" title="Copy pods/security/security-context-4.yaml to clipboard">
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="highlight">
              <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#a2f;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>security-context-demo<span style="color:#666">-4</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>sec-ctx<span style="color:#666">-4</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">image</span>:<span style="color:#bbb"> </span>gcr.io/google-samples/node-hello:<span style="color:#666">1.0</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">capabilities</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">add</span>:<span style="color:#bbb"> </span>[<span style="color:#b44">&#34;NET_ADMIN&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;SYS_TIME&#34;</span>]<span style="color:#bbb">
</span></code></pre>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      Create the Pod:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/security/security-context-4.yaml</code></pre>
    </div>
    <p>
      Get a shell into the running Container:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl <span style="color:#a2f">exec</span> -it security-context-demo-4 -- sh</code></pre>
    </div>
    <p>
      In your shell, view the capabilities for process 1:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#a2f">cd</span> /proc/1
cat status</code></pre>
    </div>
    <p>
      The output shows capabilities bitmap for the process:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">...
CapPrm:	00000000aa0435fb
CapEff:	00000000aa0435fb
...</code></pre>
    </div>
    <p>
      Compare the capabilities of the two Containers:
    </p>
    <pre><code>00000000a80425fb
00000000aa0435fb</code></pre>
    <p>
      In the capability bitmap of the first container, bits 12 and 25 are clear. In the second container,
      bits 12 and 25 are set. Bit 12 is
      <code>
        CAP_NET_ADMIN
      </code>
      , and bit 25 is
      <code>
        CAP_SYS_TIME
      </code>
      .
      See
      <a href="https://github.com/torvalds/linux/blob/master/include/uapi/linux/capability.h">
        capability.h
      </a>
      for definitions of the capability constants.
    </p>
    <blockquote class="note">
      <div>
        <strong>
          Note:
        </strong>
        Linux capability constants have the form
        <code>
          CAP_XXX
        </code>
        . But when you list capabilities in your Container manifest, you must omit the
        <code>
          CAP_
        </code>
        portion of the constant. For example, to add
        <code>
          CAP_SYS_TIME
        </code>
        , include
        <code>
          SYS_TIME
        </code>
        in your list of capabilities.
      </div>
    </blockquote>
    <h2 id="assign-selinux-labels-to-a-container">
      Assign SELinux labels to a Container
    </h2>
    <p>
      To assign SELinux labels to a Container, include the
      <code>
        seLinuxOptions
      </code>
      field in
      the
      <code>
        securityContext
      </code>
      section of your Pod or Container manifest. The
      <code>
        seLinuxOptions
      </code>
      field is an
      <a href="/docs/reference/generated/kubernetes-api/v1.18/#selinuxoptions-v1-core">
        SELinuxOptions
      </a>
      object. Here&rsquo;s an example that applies an SELinux level:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">...<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">seLinuxOptions</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">level</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;s0:c123,c456&#34;</span></code></pre>
    </div>
    <blockquote class="note">
      <div>
        <strong>
          Note:
        </strong>
        To assign SELinux labels, the SELinux security module must be loaded on the host operating system.
      </div>
    </blockquote>
    <h2 id="discussion">
      Discussion
    </h2>
    <p>
      The security context for a Pod applies to the Pod&rsquo;s Containers and also to
      the Pod&rsquo;s Volumes when applicable. Specifically
      <code>
        fsGroup
      </code>
      and
      <code>
        seLinuxOptions
      </code>
      are
      applied to Volumes as follows:
    </p>
    <ul>
      <li>
        <p>
          <code>
            fsGroup
          </code>
          : Volumes that support ownership management are modified to be owned
          and writable by the GID specified in
          <code>
            fsGroup
          </code>
          . See the
          <a href="https://git.k8s.io/community/contributors/design-proposals/storage/volume-ownership-management.md">
            Ownership Management design document
          </a>
          for more details.
        </p>
      </li>
      <li>
        <p>
          <code>
            seLinuxOptions
          </code>
          : Volumes that support SELinux labeling are relabeled to be accessible
          by the label specified under
          <code>
            seLinuxOptions
          </code>
          . Usually you only
          need to set the
          <code>
            level
          </code>
          section. This sets the
          <a href="https://selinuxproject.org/page/NB_MLS">
            Multi-Category Security (MCS)
          </a>
          label given to all Containers in the Pod as well as the Volumes.
        </p>
      </li>
    </ul>
    <blockquote class="warning">
      <div>
        <strong>
          Warning:
        </strong>
        After you specify an MCS label for a Pod, all Pods with the same label can access the Volume. If you need inter-Pod protection, you must assign a unique MCS label to each Pod.
      </div>
    </blockquote>
    <h2 id="clean-up">
      Clean up
    </h2>
    <p>
      Delete the Pod:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete pod security-context-demo
kubectl delete pod security-context-demo-2
kubectl delete pod security-context-demo-3
kubectl delete pod security-context-demo-4</code></pre>
    </div>
    <h2 id="what-s-next">
      What&#39;s next
    </h2>
    <ul>
      <li>
        <a href="/docs/reference/generated/kubernetes-api/v1.18/#podsecuritycontext-v1-core">
          PodSecurityContext
        </a>
      </li>
      <li>
        <a href="/docs/reference/generated/kubernetes-api/v1.18/#securitycontext-v1-core">
          SecurityContext
        </a>
      </li>
      <li>
        <a href="https://opensource.com/business/15/3/docker-security-tuning">
          Tuning Docker with the newest security enhancements
        </a>
      </li>
      <li>
        <a href="https://git.k8s.io/community/contributors/design-proposals/auth/security_context.md">
          Security Contexts design document
        </a>
      </li>
      <li>
        <a href="https://git.k8s.io/community/contributors/design-proposals/storage/volume-ownership-management.md">
          Ownership Management design document
        </a>
      </li>
      <li>
        <a href="/docs/concepts/policy/pod-security-policy/">
          Pod Security Policies
        </a>
      </li>
      <li>
        <a href="https://git.k8s.io/community/contributors/design-proposals/auth/no-new-privs.md">
          AllowPrivilegeEscalation design
          document
        </a>
      </li>
    </ul>
  </body>
</html>