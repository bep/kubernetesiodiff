<html><head></head><body>
    <h1>
      Monitor Node Health
    </h1>
    <p>
      <a href="https://github.com/kubernetes/website/edit/master/content/en/docs/tasks/debug-application-cluster/monitor-node-health.md" id="editPageButton" target="_blank">
        Edit This Page
      </a>
    </p>
    <h1>
      Monitor Node Health
    </h1>
    <p>
      <em>
        Node problem detector
      </em>
      is a
      <a href="/docs/concepts/workloads/controllers/daemonset/">
        DaemonSet
      </a>
      monitoring the
      node health. It collects node problems from various daemons and reports them
      to the apiserver as
      <a href="/docs/concepts/architecture/nodes/#condition">
        NodeCondition
      </a>
      and
      <a href="/docs/reference/generated/kubernetes-api/v1.18/#event-v1-core">
        Event
      </a>
      .
    </p>
    <p>
      It supports some known kernel issue detection now, and will detect more and
      more node problems over time.
    </p>
    <p>
      Currently Kubernetes won’t take any action on the node conditions and events
      generated by node problem detector. In the future, a remedy system could be
      introduced to deal with node problems.
    </p>
    <p>
      See more information
      <a href="https://github.com/kubernetes/node-problem-detector">
        here
      </a>
      .
    </p>
    <ul id="markdown-toc">
      <li>
        <a href="#before-you-begin">
          Before you begin
        </a>
      </li>
      <li>
        <a href="#limitations">
          Limitations
        </a>
      </li>
      <li>
        <a href="#enable-disable-in-gce-cluster">
          Enable/Disable in GCE cluster
        </a>
      </li>
      <li>
        <a href="#use-in-other-environment">
          Use in Other Environment
        </a>
      </li>
      <li>
        <a href="#overwrite-the-configuration">
          Overwrite the Configuration
        </a>
      </li>
      <li>
        <a href="#kernel-monitor">
          Kernel Monitor
        </a>
      </li>
      <li>
        <a href="#caveats">
          Caveats
        </a>
      </li>
    </ul>
    <h2 id="before-you-begin">
      Before you begin
    </h2>
    <p>
      You need to have a Kubernetes cluster, and the kubectl command-line tool must
      be configured to communicate with your cluster. If you do not already have a
      cluster, you can create one by using
      <a href="/docs/setup/learning-environment/minikube/">
        Minikube
      </a>
      ,
      or you can use one of these Kubernetes playgrounds:
    </p>
    <ul>
      <li>
        <a href="https://www.katacoda.com/courses/kubernetes/playground">
          Katacoda
        </a>
      </li>
      <li>
        <a href="http://labs.play-with-k8s.com/">
          Play with Kubernetes
        </a>
      </li>
    </ul>
    <p>
      To check the version, enter
      <code>
        kubectl version
      </code>
      .
    </p>
    <h2 id="limitations">
      Limitations
    </h2>
    <ul>
      <li>
        <p>
          The kernel issue detection of node problem detector only supports file based
          kernel log now. It doesn’t support log tools like journald.
        </p>
      </li>
      <li>
        <p>
          The kernel issue detection of node problem detector has assumption on kernel
          log format, and now it only works on Ubuntu and Debian. However, it is easy to extend
          it to
          <a href="/docs/tasks/debug-application-cluster/monitor-node-health/#support-other-log-format">
            support other log format
          </a>
          .
        </p>
      </li>
    </ul>
    <h2 id="enable-disable-in-gce-cluster">
      Enable/Disable in GCE cluster
    </h2>
    <p>
      Node problem detector is
      <a href="/docs/setup/best-practices/cluster-large/#addon-resources">
        running as a cluster addon
      </a>
      enabled by default in the
      gce cluster.
    </p>
    <p>
      You can enable/disable it by setting the environment variable
      <code>
        KUBE_ENABLE_NODE_PROBLEM_DETECTOR
      </code>
      before
      <code>
        kube-up.sh
      </code>
      .
    </p>
    <h2 id="use-in-other-environment">
      Use in Other Environment
    </h2>
    <p>
      To enable node problem detector in other environment outside of GCE, you can use
      either
      <code>
        kubectl
      </code>
      or addon pod.
    </p>
    <h3 id="kubectl">
      Kubectl
    </h3>
    <p>
      This is the recommended way to start node problem detector outside of GCE. It
      provides more flexible management, such as overwriting the default
      configuration to fit it into your environment or detect
      customized node problems.
    </p>
    <ul>
      <li>
        <strong>
          Step 1:
        </strong>
        <code>
          node-problem-detector.yaml
        </code>
        :
      </li>
    </ul>
    <table class="includecode" id="debug-node-problem-detector-yaml">
      <thead>
        <tr>
          <th>
            <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/debug/node-problem-detector.yaml" download="debug/node-problem-detector.yaml">
              <code>
                debug/node-problem-detector.yaml
              </code>
            </a>
            <img src="/dir2/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode(&#39;debug-node-problem-detector-yaml&#39;)" title="Copy debug/node-problem-detector.yaml to clipboard"/>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="highlight">
              <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#a2f;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>DaemonSet<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>node-problem-detector-v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">namespace</span>:<span style="color:#bbb"> </span>kube-system<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">k8s-app</span>:<span style="color:#bbb"> </span>node-problem-detector<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">version</span>:<span style="color:#bbb"> </span>v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">kubernetes.io/cluster-service</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">selector</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">matchLabels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">k8s-app</span>:<span style="color:#bbb"> </span>node-problem-detector<span style="color:#bbb">  
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">version</span>:<span style="color:#bbb"> </span>v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">kubernetes.io/cluster-service</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">template</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">k8s-app</span>:<span style="color:#bbb"> </span>node-problem-detector<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">version</span>:<span style="color:#bbb"> </span>v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">kubernetes.io/cluster-service</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">hostNetwork</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>node-problem-detector<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">image</span>:<span style="color:#bbb"> </span>k8s.gcr.io/node-problem-detector:v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">privileged</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">limits</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;200m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;100Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">requests</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;20m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;20Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">volumeMounts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>log<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/log<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">readOnly</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">volumes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>log<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">hostPath</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">path</span>:<span style="color:#bbb"> </span>/var/log/</code></pre>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      <em data-diff="">
        <strong>
          Notice that you should make sure the system log directory is right for your
          OS distro.
        </strong>
      </em>
    </p>
    <ul>
      <li>
        <strong>
          Step 2:
        </strong>
        Start node problem detector with
        <code>
          kubectl
        </code>
        :
      </li>
    </ul>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> kubectl apply -f https://k8s.io/examples/debug/node-problem-detector.yaml</code></pre>
    </div>
    <h3 id="addon-pod">
      Addon Pod
    </h3>
    <p>
      This is for those who have their own cluster bootstrap solution, and don’t need
      to overwrite the default configuration. They could leverage the addon pod to
      further automate the deployment.
    </p>
    <p>
      Just create
      <code>
        node-problem-detector.yaml
      </code>
      , and put it under the addon pods directory
      <code>
        /etc/kubernetes/addons/node-problem-detector
      </code>
      on master node.
    </p>
    <h2 id="overwrite-the-configuration">
      Overwrite the Configuration
    </h2>
    <p>
      The
      <a href="https://github.com/kubernetes/node-problem-detector/tree/v0.1/config">
        default configuration
      </a>
      is embedded when building the Docker image of node problem detector.
    </p>
    <p>
      However, you can use
      <a href="/docs/tasks/configure-pod-container/configure-pod-configmap/">
        ConfigMap
      </a>
      to overwrite it
      following the steps:
    </p>
    <ul>
      <li>
        <strong>
          Step 1:
        </strong>
        Change the config files in
        <code>
          config/
        </code>
        .
      </li>
      <li>
        <strong>
          Step 2:
        </strong>
        Create the ConfigMap
        <code>
          node-problem-detector-config
        </code>
        with
        <code>
          kubectl create configmap node-problem-detector-config --from-file=config/
        </code>
        .
      </li>
      <li>
        <strong>
          Step 3:
        </strong>
        Change the
        <code>
          node-problem-detector.yaml
        </code>
        to use the ConfigMap:
      </li>
    </ul>
    <table class="includecode" id="debug-node-problem-detector-configmap-yaml">
      <thead>
        <tr>
          <th>
            <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/debug/node-problem-detector-configmap.yaml" download="debug/node-problem-detector-configmap.yaml">
              <code>
                debug/node-problem-detector-configmap.yaml
              </code>
            </a>
            <img src="/dir2/images/copycode.svg" style="max-height:24px; cursor: pointer" onclick="copyCode(&#39;debug-node-problem-detector-configmap-yaml&#39;)" title="Copy debug/node-problem-detector-configmap.yaml to clipboard"/>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="highlight">
              <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#a2f;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>DaemonSet<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>node-problem-detector-v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">namespace</span>:<span style="color:#bbb"> </span>kube-system<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">k8s-app</span>:<span style="color:#bbb"> </span>node-problem-detector<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">version</span>:<span style="color:#bbb"> </span>v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">kubernetes.io/cluster-service</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">selector</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">matchLabels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">k8s-app</span>:<span style="color:#bbb"> </span>node-problem-detector<span style="color:#bbb">  
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">version</span>:<span style="color:#bbb"> </span>v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">kubernetes.io/cluster-service</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#a2f;font-weight:bold">template</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">k8s-app</span>:<span style="color:#bbb"> </span>node-problem-detector<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">version</span>:<span style="color:#bbb"> </span>v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">kubernetes.io/cluster-service</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">hostNetwork</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>node-problem-detector<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">image</span>:<span style="color:#bbb"> </span>k8s.gcr.io/node-problem-detector:v0<span style="color:#666">.1</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">privileged</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">limits</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;200m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;100Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">requests</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;20m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;20Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">volumeMounts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>log<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/log<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">readOnly</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># Overwrite the config/ directory with ConfigMap volume</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/config<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">readOnly</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#a2f;font-weight:bold">volumes</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>log<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">hostPath</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">path</span>:<span style="color:#bbb"> </span>/var/log/<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb"> </span><span style="color:#080;font-style:italic"># Define ConfigMap volume</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">configMap</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#a2f;font-weight:bold">name</span>:<span style="color:#bbb"> </span>node-problem-detector-config</code></pre>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <ul>
      <li>
        <strong>
          Step 4:
        </strong>
        Re-create the node problem detector with the new yaml file:
      </li>
    </ul>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> kubectl delete -f https://k8s.io/examples/debug/node-problem-detector.yaml <span style="color:#080;font-style:italic"># If you have a node-problem-detector running</span>
 kubectl apply -f https://k8s.io/examples/debug/node-problem-detector-configmap.yaml</code></pre>
    </div>
    <p>
      <em>
        <strong>
          Notice that this approach only applies to node problem detector started with
          <code>
            kubectl
          </code>
          .
        </strong>
      </em>
    </p>
    <p>
      For node problem detector running as cluster addon, because addon manager doesn’t support
      ConfigMap, configuration overwriting is not supported now.
    </p>
    <h2 id="kernel-monitor">
      Kernel Monitor
    </h2>
    <p>
      <em>
        Kernel Monitor
      </em>
      is a problem daemon in node problem detector. It monitors kernel log
      and detects known kernel issues following predefined rules.
    </p>
    <p>
      The Kernel Monitor matches kernel issues according to a set of predefined rule list in
      <a href="https://github.com/kubernetes/node-problem-detector/blob/v0.1/config/kernel-monitor.json">
        <code>
          config/kernel-monitor.json
        </code>
      </a>
      .
      The rule list is extensible, and you can always extend it by overwriting the
      configuration.
    </p>
    <h3 id="add-new-nodeconditions">
      Add New NodeConditions
    </h3>
    <p>
      To support new node conditions, you can extend the
      <code>
        conditions
      </code>
      field in
      <code>
        config/kernel-monitor.json
      </code>
      with new condition definition:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;type&#34;</span>: <span style="color:#b44">&#34;NodeConditionType&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;reason&#34;</span>: <span style="color:#b44">&#34;CamelCaseDefaultNodeConditionReason&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;message&#34;</span>: <span style="color:#b44">&#34;arbitrary default node condition message&#34;</span>
}</code></pre>
    </div>
    <h3 id="detect-new-problems">
      Detect New Problems
    </h3>
    <p>
      To detect new problems, you can extend the
      <code>
        rules
      </code>
      field in
      <code>
        config/kernel-monitor.json
      </code>
      with new rule definition:
    </p>
    <div class="highlight">
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#008000;font-weight:bold">&#34;type&#34;</span>: <span style="color:#b44">&#34;temporary/permanent&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;condition&#34;</span>: <span style="color:#b44">&#34;NodeConditionOfPermanentIssue&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;reason&#34;</span>: <span style="color:#b44">&#34;CamelCaseShortReason&#34;</span>,
  <span style="color:#008000;font-weight:bold">&#34;message&#34;</span>: <span style="color:#b44">&#34;regexp matching the issue in the kernel log&#34;</span>
}</code></pre>
    </div>
    <h3 id="change-log-path">
      Change Log Path
    </h3>
    <p>
      Kernel log in different OS distros may locate in different path. The
      <code>
        log
      </code>
      field in
      <code>
        config/kernel-monitor.json
      </code>
      is the log path inside the container.
      You can always configure it to match your OS distro.
    </p>
    <h3 id="support-other-log-format">
      Support Other Log Format
    </h3>
    <p>
      Kernel monitor uses
      <a href="https://github.com/kubernetes/node-problem-detector/blob/v0.1/pkg/kernelmonitor/translator/translator.go">
        <code>
          Translator
        </code>
      </a>
      plugin to translate kernel log the internal data structure. It is easy to
      implement a new translator for a new log format.
    </p>
    <h2 id="caveats">
      Caveats
    </h2>
    <p>
      It is recommended to run the node problem detector in your cluster to monitor
      the node health. However, you should be aware that this will introduce extra
      resource overhead on each node. Usually this is fine, because:
    </p>
    <ul>
      <li>
        The kernel log is generated relatively slowly.
      </li>
      <li>
        Resource limit is set for node problem detector.
      </li>
      <li>
        Even under high load, the resource usage is acceptable.
        (see
        <a href="https://github.com/kubernetes/node-problem-detector/issues/2#issuecomment-220255629">
          benchmark result
        </a>
        )
      </li>
    </ul>
  
</body></html>